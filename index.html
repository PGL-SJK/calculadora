<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Prazos - Timeline de Cargas</title>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #4a5568;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; font-weight: 300; }
        .main-content { display: grid; grid-template-columns: 1fr 400px; gap: 30px; margin-bottom: 40px; }
        .steps-container { display: flex; flex-direction: column; gap: 20px; }
        .step-card {
            background: rgba(255,255,255,0.95);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(226,232,240,0.8);
            transition: all 0.3s ease;
            position: relative;
        }
        .disable-btn {
            position: absolute; top: 15px; right: 15px;
            background: #e2e8f0; border: none;
            border-radius: 50%; width: 32px; height: 32px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: background 0.3s;
        }
        .disable-btn.active { background: #f87171; color: #fff; }
        .step-header { display: flex; align-items: center; margin-bottom: 20px; gap: 15px; }
        .step-number { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #81c7d4, #5dade2); color: #fff; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .step-title { font-size: 1.3rem; font-weight: 500; }
        .step-content { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: end; }
        .input-group { display: flex; flex-direction: column; gap: 8px; }
        .input-group label { font-size: 0.9rem; font-weight: 500; }
        .date-input, .period-select {
            padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 10px;
            font-size: 1rem; background: rgba(255,255,255,0.9);
        }
        .calculated-date {
            padding: 12px 16px; background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 2px solid #bae6fd; border-radius: 10px; text-align: center;
        }
        .summary-panel {
            background: rgba(255,255,255,0.95); border-radius: 16px; padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); height: fit-content;
        }
        .total-days { background: linear-gradient(135deg, #ddd6fe, #c4b5fd); padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 25px; }
        .total-days-number { font-size: 2.5rem; font-weight: bold; color: #5b21b6; display: block; }
        .timeline-container {
            background: rgba(255,255,255,0.95); border-radius: 16px; padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-top: 20px;
        }
        .timeline { display: flex; flex-direction: column; gap: 20px; position: relative; padding-left: 30px; }
        .timeline::before {
            content: ""; position: absolute; left: 10px; top: 0; bottom: 0;
            width: 4px; background: linear-gradient(to bottom, #81c7d4, #5dade2);
            border-radius: 2px;
        }
        .timeline-item {
            display: flex; flex-direction: column; gap: 5px;
            background: rgba(248,250,252,0.8); padding: 15px;
            border-radius: 12px; position: relative;
        }
        .timeline-item::before {
            content: ""; position: absolute; left: -22px; top: 20px;
            width: 14px; height: 14px; border-radius: 50%;
            background: #5dade2; border: 2px solid #fff;
        }
        .timeline-step { font-weight: 600; color: #2d3748; }
        .timeline-date { font-size: 0.95rem; color: #4a5568; }
        .timeline-days { font-size: 0.85rem; background: #81c7d4; color: white; border-radius: 12px; padding: 2px 8px; display: inline-block; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header"><h1><i class="fas fa-truck"></i> Calculadora de Prazos</h1></div>
        <div class="main-content">
            <div class="steps-container" id="steps-container"></div>
            <div class="summary-panel">
                <div class="total-days"><span id="total-days-number" class="total-days-number">0</span><div>Dias Totais</div></div>
                <button onclick="resetAll()">Limpar Tudo</button>
            </div>
        </div>
        <div class="timeline-container"><div class="timeline-title"><i class="fas fa-clock"></i> Timeline</div><div id="timeline" class="timeline"></div></div>
    </div>

    <script>
        const steps = [
            {id:'hawb', name:'Emissão HAWB', first:true},
            {id:'etd', name:'ETD'},
            {id:'chegada', name:'ETA'},
            {id:'envioRA', name:'Envio RA'},
            {id:'validacao', name:'Validação RA'},
            {id:'faturamento', name:'Envio Faturamento'},
            {id:'escrituracao', name:'Escrituração'},
            {id:'risco', name:'Risco Sacado'},
            {id:'repasse', name:'Repasse'}
        ];
        let stepData = {};

        function createStepCards() {
            const container = document.getElementById("steps-container");
            steps.forEach((step, idx) => {
                const card = document.createElement("div");
                card.className="step-card";
                card.innerHTML=`
                    <button class="disable-btn" id="${step.id}-disable" onclick="toggleStep('${step.id}')"><i class="fas fa-power-off"></i></button>
                    <div class="step-header"><div class="step-number">${idx+1}</div><div class="step-title">${step.name}</div></div>
                    <div class="step-content">
                        ${step.first ? `
                        <div class="input-group"><label>Data Inicial</label><input type="date" id="${step.id}-date" onchange="calculateFromInitial('${step.id}')"></div>
                        <div class="input-group"><label>Data Calculada</label><div id="${step.id}-calculated" class="calculated-date">Selecione</div></div>` :
                        `<div class="input-group"><label>Período</label><select id="${step.id}-period" onchange="calculateStep('${step.id}')">${periodOptions()}</select></div>
                        <div class="input-group"><label>Data Manual</label><input type="date" id="${step.id}-date" onchange="calculateFromManual('${step.id}')"></div>
                        <div class="input-group"><label>Data Calculada</label><div id="${step.id}-calculated" class="calculated-date">-</div></div>
                        <div class="input-group"><label>Dias</label><div id="${step.id}-days" class="calculated-date">0 dias</div></div>`}
                    </div>`;
                container.appendChild(card);
            });
        }
        function periodOptions() {
            const opts=[1,5,10,15,25,30,35,45,60,65,90,95];
            return `<option value="">Selecione</option>`+opts.map(d=>`<option value="${d}">${d} dias</option>`).join("");
        }
        function toggleStep(id) {
            if (!stepData[id]) return;
            stepData[id].disabled = !stepData[id].disabled;
            document.getElementById(id+"-disable").classList.toggle("active", stepData[id].disabled);
            updateSummary(); updateTimeline();
        }
        function calculateFromInitial(id) {
            const val=document.getElementById(id+'-date').value;
            if (!val) return;
            stepData[id]={date:val,days:0,disabled:false};
            document.getElementById(id+'-calculated').textContent=formatDateBR(val);
            updateSummary(); updateTimeline();
        }
        function calculateStep(id) {
            const val=parseInt(document.getElementById(id+'-period').value);
            if (!val) return;
            const prev=getPrev(id);
            if (!prev||!stepData[prev]) return alert("Configure a etapa anterior");
            const newDate=addDays(stepData[prev].date,val);
            stepData[id]={date:newDate.toISOString().split('T')[0],days:val,disabled:false};
            document.getElementById(id+'-calculated').textContent=formatDateBR(stepData[id].date);
            document.getElementById(id+'-days').textContent=val+" dias";
            updateSummary(); updateTimeline();
        }
        function calculateFromManual(id) {
            const val=document.getElementById(id+'-date').value;
            if (!val) return;
            const prev=getPrev(id);
            if (!prev||!stepData[prev]) return alert("Configure a etapa anterior");
            const diff=calculateDaysBetween(stepData[prev].date,val);
            stepData[id]={date:val,days:diff,disabled:false};
            document.getElementById(id+'-calculated').textContent=formatDateBR(val);
            document.getElementById(id+'-days').textContent=diff+" dias";
            updateSummary(); updateTimeline();
        }
        function getPrev(id){ const idx=steps.findIndex(s=>s.id===id); return idx>0?steps[idx-1].id:null; }
        function addDays(date,days){const d=new Date(date);d.setDate(d.getDate()+days);return d;}
        function calculateDaysBetween(start,end){return Math.ceil((new Date(end)-new Date(start))/(1000*60*60*24));}
        function formatDateBR(d){return new Date(d).toLocaleDateString('pt-BR');}
        function updateSummary(){
            let total=0; steps.forEach(s=>{ if(stepData[s.id]&&!stepData[s.id].disabled){total+=stepData[s.id].days;} });
            document.getElementById("total-days-number").textContent=total;
        }
        function updateTimeline(){
            const t=document.getElementById("timeline"); t.innerHTML="";
            steps.forEach(s=>{
                if(stepData[s.id]){
                    const item=document.createElement("div");
                    item.className="timeline-item";
                    item.innerHTML=`<div class="timeline-step">${s.name}</div>
                    <div class="timeline-date">${formatDateBR(stepData[s.id].date)}</div>
                    <div class="timeline-days">${stepData[s.id].disabled?"(ignorado)":stepData[s.id].days+" dias"}</div>`;
                    t.appendChild(item);
                }
            });
        }
        function resetAll(){ stepData={}; document.getElementById("steps-container").innerHTML=""; createStepCards(); updateSummary(); updateTimeline(); }
        document.addEventListener("DOMContentLoaded",()=>{createStepCards();updateTimeline();});
    </script>
</body>
</html>
